pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
-- jeu test 
-- jezzatator

function _init()
	create_player()
	init_msg()
end

function _update()
	if not messages[1] then
			player_movement()
	end
	update_camera()
	update_msg()
end

function _draw()
	cls()
	draw_map()
	draw_player()
	draw_ui()
	draw_msg()
end

-->8
-- map

function draw_map()
	map(0,0,0,0,128,64)
end

function check_flag(flag,x,y)
local sprite=mget(x,y)
return fget(sprite,flag)
end


function update_camera()
	camx=flr(p.x/16)*16
	camy=mid(0,(p.y-7.5)*8+p.oy,(31-15)*8)
	camera(camx*8,camy)
end

function next_tile(x,y)
	sprite=mget(x,y)
	mset(x,y,sprite+1)
end

function pick_up_key(x,y)
	next_tile(x,y)
	p.keys+=1
	sfx(0)
end

function open_door(x,y)
	next_tile(x,y)
	p.keys-=1
	sfx(1)
end
-->8
--player

function create_player()
	p={
		x=6,y=4,
		ox=0,oy=0,
		start_ox=0,start_oy=0,
		anim_t=0,
		sprite=16,
		keys=0
		}
end

function player_movement()
newx=p.x
newy=p.y

	if p.anim_t==0 then
	newoy=0
	newox=0
		if btn(➡️) then
		 newx+=1
		 newox=-8
		 p.flip=false
		elseif btn(⬅️) then
		 newx-=1
		 newox=8
		 p.flip=true
		elseif btn(⬆️) then
		 newy-=1
		 newoy=8
		elseif btn(⬇️) then
		 newy+=1
		 newoy=-8
		 end
	end
	
	interact(newx,newy)
	
		if not check_flag(0,newx,newy) 
		and (p.x!=newx or p.y!=newy) then
			p.x=mid(0,newx,127)
			p.y=mid(0,newy,63)
			p.start_ox=newox
			p.start_oy=newoy
			p.anim_t=1 
		end
		
		-- animation
		p.anim_t=max(p.anim_t-0.125,0)
		p.ox=p.start_ox*p.anim_t
		p.oy=p.start_oy*p.anim_t
		
		if p.anim_t>=0.5 then
			p.sprite=33
		else
			p.sprite=32
		end

end

function interact(x,y)
	if check_flag(1,x,y) then
		pick_up_key(x,y)
	elseif check_flag(2,x,y)
	and p.keys>0 then
		open_door(x,y) 
	end
	if x==6 and y==9 then
		create_meg("panneau","trouve les clefs\npour ouvrir les portes")
	end
end

function draw_player()
	spr(p.sprite,p.x*8+p.ox,p.y*8+p.oy,1,1,p.flip)
end
-->8
--ui

function draw_ui()
	camera()
	palt(0,false)
	palt(12,true)	
	spr(8,2,2)
	palt()	
	print_outline("X"..p.keys,10,2)
end

function print_outline(text,x,y)
	print(text,x-1,y,0)
	print(text,x+1,y,0)
	print(text,x,y-1,0)
	print(text,x,y+1,0)
	print(text,x,y,7)
end
-->8
--message

function init_msg()
	messages={}
end

function create_meg(name,...)
	msg_title=name
	messages={...}
end

function update_msg()
	if (btn(❎)) then 
		deli(messages,1)
	end
end

function draw_msg()
	if messages[1] then
	local y=100
	if p.y%16>8 then
		y=10
	end
	rectfill(6,y,6+#msg_title*4,y+6,2)
		print(msg_title,7,y+1,7)
		rectfill(2,y+9,125,y+21,4) 
		print(messages[1],3,y+10,7)
	end
end
__gfx__
000000003333333333bbbb33333a333311111111444444443333333333333333ccccc0cc00000000000000000000000000000000000000000000000000000000
000aa000333333333bb8bbb333a9a33311111111444444443333333333333333c0000a0c00000000000000000000000000000000000000000000000000000000
00a99a00333333333bbbb8b3333a33a3111111114444444433333333333333330aaaa0a000000000000000000000000000000000000000000000000000000000
0a9ff9a0333333333b8bbbb333333a9a111111112222222233333a33333333330990090c00000000000000000000000000000000000000000000000000000000
0a9ff9a0333333333bbbbbb333a333a311111111222222223aaaa3a333333333c00cc0cc00000000000000000000000000000000000000000000000000000000
00a99a003333333333bbbb333a9a333311111111111111113994493334444433cccccccc00000000000000000000000000000000000000000000000000000000
000aa000333333333335433333a3333311111111111111113444443334444433cccccccc00000000000000000000000000000000000000000000000000000000
0000000033333333335444333333333311111111111111113322233333222333cccccccc00000000000000000000000000000000000000000000000000000000
0000cc60044444400444200049444944333333330000000022222222000000000000000000000000000000000000000000000000000000000000000000000000
00017770444444444405200049494944399999930005000025255252000500000005000000000000000000000000000000000000000000000000000000000000
00007170944005449004200044494944344444430000000022522522000000000000000000000000000000000000000000000000000000000000000000000000
0000999994444444944420004449444434242243000000002525525200000a000000000000000000000000000000000000000000000000000000000000000000
000cc8004444445444492000494444943444444300000500252552520aaaa0a00000050000000000000000000000000000000000000000000000000000000000
077c7d1d944444549444200049449494332332330000000022522522099119000111110000000000000000000000000000000000000000000000000000000000
00776600924444449442000049449494334334330050000025255252011111000111110000000000000000000000000000000000000000000000000000000000
09904440022424240420000049449444333333330000000022222222002220000022200000000000000000000000000000000000000000000000000000000000
0000cc60000cc6000800000208000002000000002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000
00017770001177000888888208888882000000002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000
00007170000717000088888000888880000000002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000
0000999900099990008a88a0008a88a0000000002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000
000cc800000cc8000088888000888880000000002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000
077c7d1d077c7d1d0022222000222220000000002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000
00776600007766000022222000222220000000002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000
09904440000499000020005000005200000000002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010001010301000000000000000000050000010001030100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010103010101010101010101010101010101010101010101020202161616161616161616161616161616161616161616161616161616161616161615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0103010101010101010101010201010101010101010101010101010101010202161615151516151615151616151515161515161515151515151515161515151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010103010101030101010202010101010101010101010101010101010101011515161515161516151516151516161615161515161515151515151615151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010201010101010101010102010101010101010101010101010101010101011516151516151515151515161515161515161515161616161616151615151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010101010103010201030102010101010101010101010101010101010202161615151615151615151616161516161515161515151515151516151515151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0103010101010101010101010102020101010101010101010101010101010202161615151515161515161615161516161515161515161616161516151515151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010103010101010101010101020201010101010101010101010101010101161615151515151515161515161515161516161515161515161616151616151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101020101010101010301010101010101010101010101010105050101010101161515161616161615151515161515161615161515161515151616161615151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0103010101010101010101010101010101010101050505050504010101010101161516151515151615151516151515161615161516161515151516161515161615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010101031401010505050101010105050505040404010401010101010101161516151515151615151616151516161515161516151515151516151516161615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010505050511050404040505050504040404040101010101010101010101161616161615161616151515151515161515161516151516151516151616151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0505050404040413040404040404040404010101010101010101010101010101161515151615151515151616161616161615161516151516151616151615151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0404040404040411040404040404040401010101010101010101010101010101161616151615151615151515151515161616161516151516151515151615151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0404040404010101010101010101010101010101010101010101010101010101161616151615161615151515151515151515151516151515151616151515151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010101010101010101010101010101010101010101010101010101010101161616151516161515161616161615161516161616151515151616151515151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010101010101010101010101010101010101010101010101010101010101161515151516161616161616161616161616161616161516161616161616161615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010601010106010101010101010101010101010101010101010101010101161616151516151515151616151616161515161516151515151515151516151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010101010101010101010101010101010101010101010101010101010101161616151616161616151515151615161516161515151515151515151516151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010101010101010101010101010101010101010101010101010101010101161515151515161515151515161615161616161516161616161615151516151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010101010101010101010101010101010101010101010101010101010101161516161616151516161615151515161615151516151515151616161516151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0101010101010101010101010101010115151515151515151501011515151515161515151515151616171515151615151515161516151515161515161516151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0015151515151515151515151515151515151515151515151515011515151515161616161616161616161616161616161616161616151515151516161515151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0015151515151515151515151515151515151515151515151515011515151515161515151515151515151515151515161515161615151516151516151515151615151515151515151515151515151515151515151515151515151515151515151525252525252525252525252525252525252525252525252525252525252525
0015151515151515151515151515151515151515151515151515010115151515161515151515151515151515151515161515151615151516151516151616151615000000000000000000000000000000000000000000000000002525252525252525252525252525252525252525252525252525252525252525252525252525
0015151515151515151515151515151515151515151515151515150115151515161515151515151515151515151515161515151615161616151515151516151615000000000000000000000000000000000000000000000000002525252525252525252525252525252525252525252525252525252525252525252525252525
0015151515151515151515151515151515151515151515151515151501151515161515151515151515151515151515161515161615151615151615151516151615000000000000000000000000000000000000000000000000002525252525252525252525252525252525252525252525252525252525252525252525252525
0000000000000000000000000000000000000000000000000000000001010000021515151515151515151515151515151515151515151616151616151616151600000000000000000000000000000000000000000000000000002525252525252525252525252525252525252525252525252525252525252525252525252525
0000000000000000000000000000000000000000000000000000000000010101111515151515151515151515151515151515151515151516151516161615151600000000000000000000000000000000000000000000000000002525252525252525252525252525252525252525252525252525252525252525252525252525
0000000000000000000000000000000000000000000000000000000000000000021515151515151515151515151515161616161615151516151515151515151600000000000000000000000000000000000000000000000000002525252525252525252525252525252525252525252525252525252525252525252525252525
0000000000000000000000000000000000000000000000000000000000000000161515151515151515151515151515161515151615151516151515151615151600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000161616161616161616161616161616161616161616161616161616161616161600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0005000029050290502805000000000003105035050380503c0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000400000f6502a650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
