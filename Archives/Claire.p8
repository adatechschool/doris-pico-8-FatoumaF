pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
--game loop

function _init()
 map_setup()
 make_player()
end

function _update()
 update_map()
 move_player()
end

function _draw()
 cls()
 draw_map()
 draw_player()
 if (btn(❎)) show_inventory()
end
-->8
--map code

function map_setup()
    --timers
    timer=0
    anim_time=30 --30 = 1 second
   
    --map tile settings
    wall=0
    wood=1
    door=2
    anim1=3
    anim2=4
    lose=6
    win=7
   end
   
   function update_map()
    if (timer<0) then
     toggle_tiles()
     timer=anim_time
    end
    timer-=1
   end
   
   function draw_map()
    mapx=flr(p.x/16)*16
    mapy=flr(p.y/16)*16
    camera(mapx*8,mapy*8)
   
    map(0,0,0,0,128,64)
   end
   
   function is_tile(tile_type,x,y)
    tile=mget(x,y)
    has_flag=fget(tile,tile_type)
    return has_flag
   end
   
   function can_move(x,y)
    return not is_tile(wall,x,y)
   end
   
   function swap_tile(x,y)
    tile=mget(x,y)
    mset(x,y,tile+1)
   end
   
   function unswap_tile(x,y)
    tile=mget(x,y)
    mset(x,y,tile-1)
   end
   
   function get_wood(x,y)
    p.wood+=10
    swap_tile(x,y)
   end
   
   function open_door(x,y)
    swap_tile(x,y)
   end
-->8
function make_player()
    p={}
    p.x=3
    p.y=2
    p.sprite=1
    p.wood=0
   end
   
   function draw_player()
    spr(p.sprite,p.x*8,p.y*8)
   end
   
   function move_player()
    newx=p.x
    newy=p.y
    
    if (btnp(⬅️)) newx-=1
    if (btnp(➡️)) newx+=1
    if (btnp(⬆️)) newy-=1
    if (btnp(⬇️)) newy+=1
    
    interact(newx,newy)
    
    if (can_move(newx,newy)) then
     p.x=mid(0,newx,127)
     p.y=mid(0,newy,63)
    end
   end
   
   function interact(x,y)
    if (is_tile(wood,x,y)) then
     get_wood(x,y)
    elseif (is_tile(door,x,y) and p.wood>0) then
     open_door(x,y)
    end
   end

-->8
-- inventory code

function show_inventory()
    invx=mapx*8+40
    invy=mapy*8+8
    
    rectfill(invx,invy,invx+48,invy+24,0)
    print("inventory",invx+7,invy+4,7)
    print("wood "..p.wood,invx+12,invy+14,9)
   end
-->8
--animation code

function toggle_tiles()
    for x=mapx,mapx+15 do
     for y=mapy,mapy+15 do
      if (is_tile(anim1,x,y)) then
       swap_tile(x,y)
       sfx(3)
      elseif (is_tile(anim2,x,y)) then
       unswap_tile(x,y)
       sfx(3)
      end
     end
    end
   end
__gfx__
333333330eeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333eeeefee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333ef1ff1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333eeffffe00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333ee8888e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333086666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3333333308aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333086006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3333333333bbbb333333333333383333000000003abbbba33333333300000000333cc33300000000cccccccc4444444000000000000000000000000000000000
333333333bbaabb333a33333338a833300000000abbaabba333333330000000033cccc3300000000cccccccc0000044000000000000000000000000000000000
333333333bbbab133a9a33333338333300000000abbbab1a333333330000000033cccc3300000000cccccccc4444400000000000000000000000000000000000
333333333bbbb31333a333333333338300000000abbbb31a33333333000000003cccccc300000000cccccccc0000444000000000000000000000000000000000
33333333313b331333333a33333338a800000000a13b331a33333333000000003c7cccc300000000cccccccc4444000000000000000000000000000000000000
33333333331111333333a9a338333383000000003a1111a333333333000000003c777cc300000000cccccccc0004444000000000000000000000000000000000
333333333332233333333a338a8333330000000033a22a33333333330000000033cccc3300000000cccccccc4440000000000000000000000000000000000000
33333333331442333333333338333333000000003a1442a333333333000000003333333300000000cccccccc4444444000000000000000000000000000000000
33333333333333333333333300000000633d63330000000000000000333383833333333300000000000000000000000000000000000000000000000000000000
399999939993333333333333000000006d6663330000000000000000333338883933333300000000000000000000000000000000000000000000000000000000
344444439a999999333333330000000066665533000000000000000033333f5f9933333300000000000000000000000000000000000000000000000000000000
34224243939aa9a93333333300000000d66334330000000000000000993444f94443383800000000000000000000000000000000000000000000000000000000
3444444399933a3a3333333300000000366333430000000000000000394944434994388300000000000000000000000000000000000000000000000000000000
33233233aaa33333333333330000000033d6334300000000000000003249994329994f8800000000000000000000000000000000000000000000000000000000
334334333333333333333333000000003333333400000000000000003324943332944f5f00000000000000000000000000000000000000000000000000000000
33333333333333333333333300000000333333350000000000000000333d53333d5333f900000000000000000000000000000000000000000000000000000000
000000004a4444a44a4aa4a4000000003333333333333333cccccccccccccccc4444444000000000000000000000000000000000000000000000000000000000
000000004a4444a415199151000000003334433333300333cccccccccccccccc0000044000000000000000000000000000000000000000000000000000000000
000000004a4444a411111111000000003444444330000003c777cccccccccccc4444400000000000000000000000000000000000000000000000000000000000
000000004a4444a411111111000000003114444330000003cccccccccccccccc0000444000000000000000000000000000000000000000000000000000000000
00000000aaa99aaa15111151000000003444444330000003ccc777cccccccccc4444000000000000000000000000000000000000000000000000000000000000
00000000191991914a4444a4000000003444464330000003cccccccccccccccc0004444000000000000000000000000000000000000000000000000000000000
000000004a4444a44a4444a4000000003114444330000003cccccccccccccccc4440000000000000000000000000000000000000000000000000000000000000
000000004a4444a44a4444a4000000003444444330000003cccccccccccccccc4444444000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000010000000300000000050000000000010300000000000911000000000000000003010005000105000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1111111110121111111110101111111110101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111101115111110101111111010101510101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111131010101010101010101111101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010121010101111101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010101310151111101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101012101010101012101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110131010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010101010101013101027111111101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1510101010101010101010101011111110101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010111010101010101010111010101037101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101015111010101010101010151010101037101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101015101010101010101010111010103737101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1127101010101015111511101010111010373737101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1110101010111110101010101111111010373837101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111115111110111011111111111010373710101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101011111110111111111010101010373710101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101037371010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010373737371010103737371010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101037371a1a373637373737373736101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3737373737361a1a373737373637373737101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3737363737371a1a101037373737363737101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00050000240700e00033070330703307033060330503305033030330200e0000d0000e0000e000000000e0000d0000d0000000000000000000000000000000000000000000000000000000000000000000000000
